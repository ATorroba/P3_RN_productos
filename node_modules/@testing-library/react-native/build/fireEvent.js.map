{"version":3,"file":"fireEvent.js","names":["isTextInput","element","TextInput","require","filterNodeByType","isTouchResponder","isHostElement","props","onStartShouldSetResponder","isPointerEventEnabled","isParent","parentCondition","pointerEvents","parent","isTouchEvent","eventName","isEventEnabled","touchResponder","editable","touchStart","touchMove","onMoveShouldSetResponder","undefined","findEventHandler","callsite","nearestTouchResponder","handler","getEventHandler","eventHandlerName","toEventHandlerName","invokeEvent","data","returnValue","act","charAt","toUpperCase","slice","pressHandler","changeTextHandler","scrollHandler","fireEvent","press","changeText","scroll"],"sources":["../src/fireEvent.ts"],"sourcesContent":["import { ReactTestInstance } from 'react-test-renderer';\nimport act from './act';\nimport { isHostElement } from './helpers/component-tree';\nimport { filterNodeByType } from './helpers/filterNodeByType';\n\ntype EventHandler = (...args: any) => unknown;\n\nconst isTextInput = (element?: ReactTestInstance) => {\n  if (!element) {\n    return false;\n  }\n\n  const { TextInput } = require('react-native');\n  // We have to test if the element type is either the TextInput component\n  // (which would if it is a composite component) or the string\n  // TextInput (which would be true if it is a host component)\n  // All queries but the one by testID return composite component and event\n  // if all queries returned host components, since fireEvent bubbles up\n  // it would trigger the parent prop without the composite component check\n  return (\n    filterNodeByType(element, TextInput) ||\n    filterNodeByType(element, 'TextInput')\n  );\n};\n\nconst isTouchResponder = (element?: ReactTestInstance) => {\n  if (!isHostElement(element)) return false;\n\n  return !!element?.props.onStartShouldSetResponder || isTextInput(element);\n};\n\nconst isPointerEventEnabled = (\n  element?: ReactTestInstance,\n  isParent?: boolean\n): boolean => {\n  const parentCondition = isParent\n    ? element?.props.pointerEvents === 'box-only'\n    : element?.props.pointerEvents === 'box-none';\n\n  if (element?.props.pointerEvents === 'none' || parentCondition) {\n    return false;\n  }\n\n  if (!element?.parent) return true;\n\n  return isPointerEventEnabled(element.parent, true);\n};\n\nconst isTouchEvent = (eventName?: string) => {\n  return eventName === 'press';\n};\n\nconst isEventEnabled = (\n  element?: ReactTestInstance,\n  touchResponder?: ReactTestInstance,\n  eventName?: string\n) => {\n  if (isTextInput(element)) return element?.props.editable !== false;\n  if (!isPointerEventEnabled(element) && isTouchEvent(eventName)) return false;\n\n  const touchStart = touchResponder?.props.onStartShouldSetResponder?.();\n  const touchMove = touchResponder?.props.onMoveShouldSetResponder?.();\n\n  if (touchStart || touchMove) return true;\n\n  return touchStart === undefined && touchMove === undefined;\n};\n\nconst findEventHandler = (\n  element: ReactTestInstance,\n  eventName: string,\n  callsite?: any,\n  nearestTouchResponder?: ReactTestInstance\n): EventHandler | null => {\n  const touchResponder = isTouchResponder(element)\n    ? element\n    : nearestTouchResponder;\n\n  const handler = getEventHandler(element, eventName);\n  if (handler && isEventEnabled(element, touchResponder, eventName))\n    return handler;\n\n  if (element.parent === null || element.parent.parent === null) {\n    return null;\n  }\n\n  return findEventHandler(element.parent, eventName, callsite, touchResponder);\n};\n\nconst getEventHandler = (\n  element: ReactTestInstance,\n  eventName: string\n): EventHandler | undefined => {\n  const eventHandlerName = toEventHandlerName(eventName);\n  if (typeof element.props[eventHandlerName] === 'function') {\n    return element.props[eventHandlerName];\n  }\n\n  if (typeof element.props[eventName] === 'function') {\n    return element.props[eventName];\n  }\n\n  return undefined;\n};\n\nconst invokeEvent = (\n  element: ReactTestInstance,\n  eventName: string,\n  callsite?: any,\n  ...data: Array<any>\n) => {\n  const handler = findEventHandler(element, eventName, callsite);\n\n  if (!handler) {\n    return;\n  }\n\n  let returnValue;\n\n  act(() => {\n    returnValue = handler(...data);\n  });\n\n  return returnValue;\n};\n\nconst toEventHandlerName = (eventName: string) =>\n  `on${eventName.charAt(0).toUpperCase()}${eventName.slice(1)}`;\n\nconst pressHandler = (element: ReactTestInstance, ...data: Array<any>): void =>\n  invokeEvent(element, 'press', pressHandler, ...data);\nconst changeTextHandler = (\n  element: ReactTestInstance,\n  ...data: Array<any>\n): void => invokeEvent(element, 'changeText', changeTextHandler, ...data);\nconst scrollHandler = (element: ReactTestInstance, ...data: Array<any>): void =>\n  invokeEvent(element, 'scroll', scrollHandler, ...data);\n\nconst fireEvent = (\n  element: ReactTestInstance,\n  eventName: string,\n  ...data: Array<any>\n): void => invokeEvent(element, eventName, fireEvent, ...data);\n\nfireEvent.press = pressHandler;\nfireEvent.changeText = changeTextHandler;\nfireEvent.scroll = scrollHandler;\n\nexport default fireEvent;\n"],"mappings":"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"}